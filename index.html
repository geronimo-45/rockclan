<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>RockClan 랭킹 및 기록실</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/recharts/umd/Recharts.min.js"></script>
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  <style>
    body { font-family: 'Pretendard', sans-serif; background: #111; color: #eee; margin: 0; }
    header { background: #222; padding: 20px; text-align: center; font-size: 1.8em; font-weight: bold; }
    section { padding: 20px; }
    .table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    .table th, .table td { padding: 8px; border-bottom: 1px solid #444; }
    .table th { background: #333; }
    .matchday { background: #1c1c1c; padding: 10px; border-radius: 8px; margin-top: 15px; }
    .matchday h3 { cursor: pointer; margin: 0; color: #99ccff; }
  </style>
</head>
<body>
  <header>RockClan 클랜 랭킹 & 기록실</header>
  <section id="root"></section>
  <script type="text/babel">

    const { useState, useEffect } = React;
    const { LineChart, Line, XAxis, YAxis, Tooltip, Legend, ResponsiveContainer } = Recharts;

    const App = () => {
      const [data, setData] = useState(null);
      const [expanded, setExpanded] = useState({});

      useEffect(() => {
        fetch('data.json')
          .then(r => r.json())
          .then(setData)
          .catch(e => console.error('data.json 로드 오류:', e));
      }, []);

      if (!data) return <div>데이터 로딩 중...</div>;

      const toggle = (d) => setExpanded(prev => ({...prev, [d]: !prev[d]}));

      return (
        <div>
          <h2>📊 클랜원 랭킹</h2>
          <table className="table">
            <thead>
              <tr><th>Rank</th><th>ID</th><th>Race</th><th>Tier</th><th>ELO</th><th>W/L</th></tr>
            </thead>
            <tbody>
              {data.players.sort((a,b)=>b.elo - a.elo).map((p,i)=>(
                <tr key={p.id}>
                  <td>{i+1}</td>
                  <td>{p.id}</td>
                  <td>{p.race}</td>
                  <td>{p.tier}</td>
                  <td>{p.elo}</td>
                  <td>{p.win} / {p.loss}</td>
                </tr>
              ))}
            </tbody>
          </table>

          <h2>📜 기록실 (Match Records)</h2>
          {data.matches.map((m, idx)=>(
            <div className="matchday" key={idx}>
              <h3 onClick={()=>toggle(idx)}>
                {m.date} - {m.map} ({m.score})
              </h3>
              {expanded[idx] && (
                <div style={{marginLeft:'10px'}}>
                  <p><b>Team1:</b> {m.team1?.join(', ') || m.player1}</p>
                  <p><b>Team2:</b> {m.team2?.join(', ') || m.player2}</p>
                  <p><b>Winner:</b> {Array.isArray(m.winner) ? m.winner.join(', ') : m.winner}</p>
                </div>
              )}
            </div>
          ))}

          <h2>📈 ELO 변동 그래프</h2>
          <ResponsiveContainer width="100%" height={400}>
            <LineChart>
              <XAxis dataKey="round" />
              <YAxis />
              <Tooltip />
              <Legend />
              {data.players.map(p => (
                <Line key={p.id} type="monotone" data={p.history.map((h,idx)=>({round:idx, value:h}))}
                      dataKey="value" name={p.id} dot={false} />
              ))}
            </LineChart>
          </ResponsiveContainer>
        </div>
      );
    };

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
